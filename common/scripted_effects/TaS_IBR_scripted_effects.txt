IBRWarsCheckPeace = {
	if = {
		limit = {
			POR = { united_portugal = yes }
		}
		POR = {
			IBRWarsResign = yes
			country_event = { id = iberiawars.20 }
			if = {
				limit = {
					has_game_rule = {
						rule = POR_IBERIAN_WARS_OTCOME
						option = POR_IBERIAN_WARS_OTCOME_POR
					}
				}
				POR = { remove_war_buff = yes }
			}
		}
		MAR = {
			set_temp_variable = { target = PPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			GNS = { united_portugal = yes }
		}
		GNS = {
			IBRWarsResign = yes
			country_event = {
				id = iberiawars.33
				days = 15
			}
		}
		MAR = {
			set_temp_variable = { target = PPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			GNS = { united_portugal = yes }
			all_state = {
				OR = {
					is_spanish_state = no
					THIS.owner = {
						OR = {
							is_subject_of = GNS
							tag = ITA
						}
					}
				}
			}
		}
		GNS = {
			IBRWarsResign = yes
			country_event = {
				id = iberiawars.23
			}
			if = {
				limit = {
					has_game_rule = {
						rule = POR_IBERIAN_WARS_OTCOME
						option = POR_IBERIAN_WARS_OTCOME_GNS
					}
				}
				GNS = { remove_war_buff = yes }
			}
		}
		MAR = {
			set_temp_variable = { target = PPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			RPP = { united_portugal = yes }
		}
		RPP = {
			IBRWarsResign = yes
			country_event = { id = iberiawars.21 }
			if = {
				limit = {
					has_game_rule = {
						rule = POR_IBERIAN_WARS_OTCOME
						option = POR_IBERIAN_WARS_OTCOME_RPP
					}
				}
				RPP = { remove_war_buff = yes }
			}

		}
		MAR = {
			set_temp_variable = { target = PPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			PPR = { united_portugal = yes }
		}
		PPR = {
			IBRWarsResign = yes
			country_event = { id = iberiawars.22 }
			if = {
				limit = {
					has_game_rule = {
						rule = POR_IBERIAN_WARS_OTCOME
						option = POR_IBERIAN_WARS_OTCOME_PPR
					}
				}
				PPR = { remove_war_buff = yes }
			}
			if = {
				limit = { has_country_flag = MAR_supported_PPR }
				econ_join_sphere_MAR = yes
				add_ideas = RUSAlliance_Observer
				MAR = {
					country_event = { id = berez_dobrovoltsy.26 days = 3 }
					TaS_dobrovoltsy_dynmod_victory = yes
				}
			}
		}
	}
	if = {
		limit = {
			SPS = { united_spain = yes }
		}
		SPS = {
			IBRWarsResign = yes
			country_event = { id = iberiawars.26 }
			if = {
				limit = {
					has_game_rule = {
						rule = SPA_IBERIAN_WARS_OTCOME
						option = SPA_IBERIAN_WARS_OTCOME_SPS
					}
				}
				SPS = { remove_war_buff = yes }
			}
		}
		#Superpowers lose the Iberian Wars Deccat
		USA = {
			country_event = { id = USA.1917 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		GER = {
			country_event = { id = reich_shared.26 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		JAP = {
			country_event = { id = jap.205 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		MAR = {
			set_temp_variable = { target = SPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			IBR = { united_portugal = yes }
			IBR = { united_spain = yes }
		}
		IBR = {
			IBRWarsResign = yes
			country_event = { id = iberiawars.24 }
			if = {
				limit = {
					has_game_rule = {
						rule = SPA_IBERIAN_WARS_OTCOME
						option = SPA_IBERIAN_WARS_OTCOME_IBR
					}
				}
				IBR = { remove_war_buff = yes }
			}
		}
		#Superpowers lose the Iberian Wars Deccat
		USA = {
			country_event = { id = USA.1917 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		GER = {
			country_event = { id = reich_shared.26 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		JAP = {
			country_event = { id = jap.205 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		MAR = {
			set_temp_variable = { target = SPR }
			TNO_clear_num_volunteers = yes
			set_temp_variable = { target = PPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			FSR = { united_portugal = yes }
			FSR = { united_spain = yes }
		}
		FSR = {
			IBRWarsResign = yes
			country_event = { id = iberiawars.25 }
			if = {
				limit = {
					has_game_rule = {
						rule = SPA_IBERIAN_WARS_OTCOME
						option = SPA_IBERIAN_WARS_OTCOME_FSR
					}
				}
				FSR = { remove_war_buff = yes }
			}
		}
		#Superpowers lose the Iberian Wars Deccat
		USA = {
			country_event = { id = USA.1917 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		GER = {
			country_event = { id = reich_shared.26 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		JAP = {
			country_event = { id = jap.205 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 3 }
			set_temp_variable = { Victory_Points = 0 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		MAR = {
			set_temp_variable = { target = SPR }
			TNO_clear_num_volunteers = yes
			set_temp_variable = { target = PPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			FZL = { united_spain = yes }
		}
		FZL = {
			IBRWarsResign = yes
			set_cosmetic_tag = FZL_unified
			country_event = {
				id = iberiawars.27
				days = 7
			}
		}
		#Superpowers lose the Iberian Wars Deccat
		USA = {
			country_event = { id = USA.1917 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 2 }
			set_temp_variable = { Victory_Points = -100 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		GER = {
			country_event = { id = reich_shared.26 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 4 }
			set_temp_variable = { Victory_Points = 100 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		JAP = {
			country_event = { id = jap.205 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 2 }
			set_temp_variable = { Victory_Points = -100 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		MAR = {
			set_temp_variable = { target = SPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			FZL = { united_spain = yes }
			all_state = {
				OR = {
					is_portuguese_state = no
					THIS.owner = {
						is_subject_of = FZL
					}
				}
			}
		}
		FZL = {
			IBRWarsResign = yes
			country_event = { id = iberiawars.29 }
			if = {
				limit = {
					has_game_rule = {
						rule = SPA_IBERIAN_WARS_OTCOME
						option = SPA_IBERIAN_WARS_OTCOME_FZL
					}
				}
				FZL = { remove_war_buff = yes }
			}
		}
		MAR = {
			set_temp_variable = { target = SPR }
			TNO_clear_num_volunteers = yes
			TaS_dobrovoltsy_dynmod_lose = yes
		}
	}
	if = {
		limit = {
			SPR = { exists = yes }
			IBR = { exists = no }
			SPS = { exists = no }
			FSR = { exists = no }
			FZL = { exists = no }
			TBA = { exists = no }
		}
		SPR = {
			IBRWarsResign = yes
			country_event = {
				id = iberiawars.28
			}
			if = {
				limit = {
					has_game_rule = {
						rule = SPA_IBERIAN_WARS_OTCOME
						option = SPA_IBERIAN_WARS_OTCOME_SPR
					}
				}
				SPR = { remove_war_buff = yes }
			}
			if = {
				limit = { has_country_flag = MAR_supported_SPR }
				#econ_join_sphere_MAR = yes
				MAR = {
					country_event = { id = berez_dobrovoltsy.25 days = 3 }
					TaS_dobrovoltsy_dynmod_victory = yes
				}
			}
		}
		every_country = {
			limit = {
				is_iberian_minor = yes
			}
			IBRWarsResign = yes
		}
		#Superpowers lose the Iberian Wars Deccat
		USA = {
			country_event = { id = USA.1917 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 4 }
			set_temp_variable = { Victory_Points = 100 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		GER = {
			country_event = { id = reich_shared.26 }
			set_temp_variable = { Victory_ID = 18 }
			set_temp_variable = { Victory_Outcome = 2 }
			set_temp_variable = { Victory_Points = -100 }
			Cold_War_GUI_ManipulateVictory = yes
		}
		JAP = {
			country_event = { id = jap.205 }
			if = {
				limit = {
					OR = {
						GAL = { exists = yes }
						CTL = { exists = yes }
						BSQ = { exists = yes }
					}
				}
				set_temp_variable = { Victory_ID = 18 }
				set_temp_variable = { Victory_Outcome = 4 }
				set_temp_variable = { Victory_Points = 100 }
				Cold_War_GUI_ManipulateVictory = yes
			}
			else_if = {
				limit = {
					RIF = { exists = yes }
				}
				set_temp_variable = { Victory_ID = 18 }
				set_temp_variable = { Victory_Outcome = 4 }
				set_temp_variable = { Victory_Points = 25 }
				Cold_War_GUI_ManipulateVictory = yes
			}
			else = {
				set_temp_variable = { Victory_ID = 18 }
				set_temp_variable = { Victory_Outcome = 2 }
				set_temp_variable = { Victory_Points = -100 }
				Cold_War_GUI_ManipulateVictory = yes
			}
		}
	}
	if = {
		limit = {
			MOR = { exists = no }
		}
		TRZ = {
			IBRWarsResign = yes
		}
		RIF = {
			IBRWarsResign = yes
			if = {
				limit = {
					has_game_rule = {
						rule = MOR_IBERIAN_WARS_OTCOME
						option = MOR_IBERIAN_WARS_OTCOME_ANTI_MOROCCO
					}
				}
				RIF = { remove_war_buff = yes }
			}
		}
	}
	if = {
		limit = {
			TRZ = { exists = no }
			RIF = { exists = no }
		}
		MOR = {
			IBRWarsResign = yes
			if = {
				limit = {
					has_game_rule = {
						rule = MOR_IBERIAN_WARS_OTCOME
						option = MOR_IBERIAN_WARS_OTCOME_MOR
					}
				}
				MOR = { remove_war_buff = yes }
			}
		}
	}
}